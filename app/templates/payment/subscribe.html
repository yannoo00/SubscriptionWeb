{% extends 'base.html' %}

{% block content %}
  <h2>구독 결제</h2>
  <form id="payment-form" action="{{ url_for('payments.subscribe') }}" method="post">
    <div>
      <label for="card_number">카드 번호</label>
      <input type="text" id="card_number" name="card_number" required>
    </div>
    <div>
      <label for="exp_month">만료 월</label>
      <input type="number" id="exp_month" name="exp_month" required>
    </div>
    <div>
      <label for="exp_year">만료 년</label>
      <input type="number" id="exp_year" name="exp_year" required>
    </div>
    <div>
      <label for="card_password">카드 비밀번호 앞 2자리</label>
      <input type="password" id="card_password" name="card_password" required>
    </div>
    <div>
      <label for="birthday">생년월일 (YYMMDD)</label>
      <input type="text" id="birthday" name="birthday" required>
    </div>
    <button type="submit">구독하기</button>
  </form>

  <script src="https://js.tosspayments.com/v1/payment"></script>
  <script>
    var clientKey = '{{ client_key }}';
    var tossPayments = TossPayments(clientKey);

    var paymentForm = document.getElementById('payment-form');
    paymentForm.addEventListener('submit', function (event) {
      event.preventDefault();

      tossPayments.requestBillingAuth('카드', {
        customerKey: '{{ current_user.id }}',
        successUrl: window.location.origin + '{{ url_for("payments.subscribe") }}',
        failUrl: window.location.origin + '{{ url_for("payments.subscribe") }}'
      });
    });
  </script>
{% endblock %}